function GetJSONFromPage(n){var r={},u,t,i;for(r.Frames=[],r.ID=n,r.CurrentFrame=$("#"+n+"_CurrentFrame").val(),r.CurrentThrow=$("#"+n+"_CurrentThrow").val(),r.ScoreUpToFrame=$("#"+n+"_ScoreUpToFrame").val(),ClearHighlight(n,parseInt(r.CurrentFrame)),u=1;u<=10;u++)t={},i="#"+n+"_"+u+"_",t.GameID=n,t.ID=$(i+"FrameID").val(),t.FrameScore=$(i+"hidFrameScore").val(),t.FrameTotal=$(i+"hidFrameTotal").val(),t.FrameNum=$(i+"hidFrameNum").val(),t.ThrowOneScore=$(i+"1_hidFrame").val(),t.ThrowTwoScore=$(i+"2_hidFrame").val(),t.ThrowOnePins=$(i+"1_hidPins").val(),t.ThrowTwoPins=$(i+"2_hidPins").val(),u===10&&(t.ThrowThreeScore=$(i+"3_hidFrame").val(),t.ThrowThreePins=$(i+"3_hidPins").val()),r.Frames.push(t);return JSON.stringify(r)}function UpdateCurrentThrowVal(n){var o=parseInt($("#"+n+"_CurrentThrow").val()),i=parseInt($("#"+n+"_CurrentFrame").val()),r="#"+n+"_"+i+"_",t=parseInt(GetThrowNum(parseInt(o))),u=GetThrowPins(n,i,t),f,e;$(r+t+"_hidFrame").val(u.score);$(r+t+"_hidPins").val(u.missed);i===10&&t===1;t===2&&(f=GetThrowHidVals(n,i,1),i===10&&f.score===10&&$(r+t+"_hidFrame").val(u.score));t===3&&(f=GetThrowHidVals(n,i,1),e=GetThrowHidVals(n,i,2),f.score==10&&e.score<10?$(r+t+"_hidFrame").val(u.score-e.score):$(r+t+"_hidFrame").val(u.score))}function GetThrowPins(n){var t=0,i=10,r=$("#"+n+"-Missed_1"),u=$("#"+n+"-Missed_2"),f=$("#"+n+"-Missed_3"),e=$("#"+n+"-Missed_4"),o=$("#"+n+"-Missed_5"),s=$("#"+n+"-Missed_6"),h=$("#"+n+"-Missed_7"),c=$("#"+n+"-Missed_8"),l=$("#"+n+"-Missed_9"),a=$("#"+n+"-Missed_10");return(r.is(":checked")||r.is(":disabled"))&&(i=i-1),(u.is(":checked")||u.is(":disabled"))&&(i=i-1),(f.is(":checked")||f.is(":disabled"))&&(i=i-1),(e.is(":checked")||e.is(":disabled"))&&(i=i-1),(o.is(":checked")||o.is(":disabled"))&&(i=i-1),(s.is(":checked")||s.is(":disabled"))&&(i=i-1),(h.is(":checked")||h.is(":disabled"))&&(i=i-1),(c.is(":checked")||c.is(":disabled"))&&(i=i-1),(l.is(":checked")||l.is(":disabled"))&&(i=i-1),(a.is(":checked")||a.is(":disabled"))&&(i=i-1),r.is(":checked")&&(t=t+MISSED_1),u.is(":checked")&&(t=t+MISSED_2),f.is(":checked")&&(t=t+MISSED_3),e.is(":checked")&&(t=t+MISSED_4),o.is(":checked")&&(t=t+MISSED_5),s.is(":checked")&&(t=t+MISSED_6),h.is(":checked")&&(t=t+MISSED_7),c.is(":checked")&&(t=t+MISSED_8),l.is(":checked")&&(t=t+MISSED_9),a.is(":checked")&&(t=t+MISSED_10),{missed:t,score:i}}function GetThrowHidVals(n,t,i){var r=parseInt($("#"+n+"_"+t+"_"+i+"_hidFrame").val()),u=parseInt($("#"+n+"_"+t+"_"+i+"_hidPins").val());return{missed:u,score:r}}function RefreshGameHid(n){var t,i;for($("#"+n.ID+"_CurrentFrame").val(n.CurrentFrame),$("#"+n.ID+"_CurrentThrow").val(n.CurrentThrow),$("#"+n.ID+"_ScoreUpToFrame").val(n.ScoreUpToFrame),t=1;t<=10;t++)$("#"+n.ID+"_"+t+"_hidFrameScore").val(n.Frames[t-1].FrameScore),$("#"+n.ID+"_"+t+"_hidFrameTotal").val(n.Frames[t-1].FrameTotal),$("#"+n.ID+"_"+t+"_1_hidFrame").val(n.Frames[t-1].ThrowOneScore),$("#"+n.ID+"_"+t+"_2_hidFrame").val(n.Frames[t-1].ThrowTwoScore),$("#"+n.ID+"_"+t+"_1_hidPins").val(n.Frames[t-1].ThrowOnePins),$("#"+n.ID+"_"+t+"_2_hidPins").val(n.Frames[t-1].ThrowTwoPins),t===10&&($("#"+n.ID+"_"+t+"_3_hidFrame").val(n.Frames[t-1].ThrowThreeScore),$("#"+n.ID+"_"+t+"_3_hidPins").val(n.Frames[t-1].ThrowThreePins)),(t<parseInt(n.ScoreUpToFrame)||parseInt(n.ScoreUpToFrame)===10)&&SetLabelsFromHid(n.ID,t),FormatFrameThrowLabels(n.ID,t);i=$("#"+n.ID+"_"+n.CurrentFrame+"_"+GetThrowNum(n.CurrentThrow)+"_hidPins").val();RefreshPinsOfCurrentThrow(n.ID,i,n.CurrentFrame,n.CurrentThrow,n.ScoreUpToFrame)}function RefreshPinsOfCurrentThrow(n,t,i,r,u){const e=new Set([1,3,5,7,9,11,13,15,17,19]),o=new Set([2,4,6,8,10,12,14,16,18]),s=new Set([20,21]);var f=parseInt($("#"+n+"_"+i+"_"+GetThrowNum(r-1)+"_hidPins").val());EnableAllMissedPins(n);r=parseInt(r);u=parseInt(u);e.has(r)?SetMissedPinsChecked(n,t):o.has(r)?(SetMissedPinsEnabled(n,f),u>=i?SetMissedPinsChecked(n,t):SetMissedPinsChecked(n,f)):s.has(r)&&(f===0?SetMissedPinsChecked(n,t):(SetMissedPinsEnabled(n,f),SetMissedPinsChecked(n,t)))}function SetMissedPinsChecked(n,t){$("#"+n+"-Missed_1").prop("checked",(t&MISSED_1)===MISSED_1);$("#"+n+"-Missed_2").prop("checked",(t&MISSED_2)===MISSED_2);$("#"+n+"-Missed_3").prop("checked",(t&MISSED_3)===MISSED_3);$("#"+n+"-Missed_4").prop("checked",(t&MISSED_4)===MISSED_4);$("#"+n+"-Missed_5").prop("checked",(t&MISSED_5)===MISSED_5);$("#"+n+"-Missed_6").prop("checked",(t&MISSED_6)===MISSED_6);$("#"+n+"-Missed_7").prop("checked",(t&MISSED_7)===MISSED_7);$("#"+n+"-Missed_8").prop("checked",(t&MISSED_8)===MISSED_8);$("#"+n+"-Missed_9").prop("checked",(t&MISSED_9)===MISSED_9);$("#"+n+"-Missed_10").prop("checked",(t&MISSED_10)===MISSED_10)}function SetMissedPinsEnabled(n,t){$("#"+n+"-Missed_1").prop("disabled",(t&MISSED_1)!==MISSED_1);$("#"+n+"-Missed_2").prop("disabled",(t&MISSED_2)!==MISSED_2);$("#"+n+"-Missed_3").prop("disabled",(t&MISSED_3)!==MISSED_3);$("#"+n+"-Missed_4").prop("disabled",(t&MISSED_4)!==MISSED_4);$("#"+n+"-Missed_5").prop("disabled",(t&MISSED_5)!==MISSED_5);$("#"+n+"-Missed_6").prop("disabled",(t&MISSED_6)!==MISSED_6);$("#"+n+"-Missed_7").prop("disabled",(t&MISSED_7)!==MISSED_7);$("#"+n+"-Missed_8").prop("disabled",(t&MISSED_8)!==MISSED_8);$("#"+n+"-Missed_9").prop("disabled",(t&MISSED_9)!==MISSED_9);$("#"+n+"-Missed_10").prop("disabled",(t&MISSED_10)!==MISSED_10)}function EnableAllMissedPins(n){$("#"+n+"-Missed_1").prop("disabled",!1);$("#"+n+"-Missed_2").prop("disabled",!1);$("#"+n+"-Missed_3").prop("disabled",!1);$("#"+n+"-Missed_4").prop("disabled",!1);$("#"+n+"-Missed_5").prop("disabled",!1);$("#"+n+"-Missed_6").prop("disabled",!1);$("#"+n+"-Missed_7").prop("disabled",!1);$("#"+n+"-Missed_8").prop("disabled",!1);$("#"+n+"-Missed_9").prop("disabled",!1);$("#"+n+"-Missed_10").prop("disabled",!1)}function SetLabelsFromHid(n,t){EmptyFrameLabels(n,t);$("#"+n+"_"+t+"_lblFrameTotal").append($("#"+n+"_"+t+"_hidFrameTotal").val())}function EmptyFrameLabels(n,t){$("#"+n+"_"+t+"_lblFrameTotal").empty();$("#"+n+"_"+t+"_1_lblFrame").empty();$("#"+n+"_"+t+"_2_lblFrame").empty();t===10&&$("#"+n+"_"+t+"_3_lblFrame").empty()}function FormatFrameThrowLabels(n,t){var i=parseInt($("#"+n+"_"+t+"_1_hidFrame").val()),r=parseInt($("#"+n+"_"+t+"_2_hidFrame").val()),f=parseInt($("#"+n+"_ScoreUpToFrame").val()),u;t!==10?i===10?$("#"+n+"_"+t+"_2_lblFrame").empty().append("X"):i+r===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append("/")):($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)):(u=parseInt($("#"+n+"_"+t+"_3_hidFrame").val()),i===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append("X"),r===10?$("#"+n+"_"+t+"_2_lblFrame").empty().append("X"):$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)):i+r===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append("/")):($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)),u===10?$("#"+n+"_"+t+"_3_lblFrame").empty().append("X"):r+u===10?$("#"+n+"_"+t+"_3_lblFrame").empty().append("/"):$("#"+n+"_"+t+"_3_lblFrame").empty().append(u),u===0&&(f<t?$("#"+n+"_"+t+"_3_lblFrame").empty():$("#"+n+"_"+t+"_3_lblFrame").empty().append("-")));i===0&&(f<t?$("#"+n+"_"+t+"_1_lblFrame").empty():$("#"+n+"_"+t+"_1_lblFrame").empty().append("-"));r===0&&i!==10&&(f<t?$("#"+n+"_"+t+"_2_lblFrame").empty():$("#"+n+"_"+t+"_2_lblFrame").empty().append("-"))}function ClearHighlight(n,t){var i="#"+n+"_"+t+"_";$(i+"1_tdFrame").css("background-color","White");$(i+"2_tdFrame").css("background-color","White");$(i+"tdFrameScore").css("background-color","White");(t===10||t===9)&&$("#"+n+"_10_3_tdFrame").css("background-color","White")}function HighlightSelectedFrame(n,t,i){var u="#"+n+"_"+t+"_",r;$(u+"1_tdFrame").css("background-color","Aquamarine");$(u+"2_tdFrame").css("background-color","Aquamarine");$(u+"tdFrameScore").css("background-color","Aquamarine");t===10?($(u+"3_tdFrame").css("background-color","Aquamarine"),i===21?$(u+"3_tdFrame").css("background-color","Plum"):(r=i%2,r===0&&(r=2),r===1?$(u+"1_tdFrame").css("background-color","Plum"):r===2&&$(u+"2_tdFrame").css("background-color","Plum"))):(r=i%2,r===0&&(r=2),r===1?$(u+"1_tdFrame").css("background-color","Plum"):r===2&&$(u+"2_tdFrame").css("background-color","Plum"))}function MissedNoneClick(n){SetMissedPinsChecked(n,MISSED_0)}function NextClickSendGame(n){UpdateCurrentThrowVal(n);var i=GetJSONFromPage(n),t=JSON.parse(i);t=ThrowCurrent(t);RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow)}function PreviousClickSendGame(n){var i=GetJSONFromPage(n),t=JSON.parse(i);t=CalculatePrevious(t);RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow)}function SaveGameClick(n){var t=GetJSONFromPage(n),i={JSONGame:t,GameID:n};$.ajax({type:"POST",traditional:!0,async:!1,cache:!1,url:"/Game/SaveGameClick",context:document.body,data:i,success:function(n){var t=JSON.parse(n.jsonGameReturned);if(n.redirect){window.location="/Game/Edit/"+t.ID;return}RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow);$("#SavedAlert").fadeTo(4e3,500).slideDown(500,function(){$("#SavedAlert").slideUp(500)})},error:function(n){console.log(n.responseText);alert(n.responseText)}})}function SaveAllClick(){for(var t=GetGameIDs(),n=0;n<t.length;n++)SaveGameClick(t[n])}function GetGameIDs(){var n=[];return $(".hidGameID").each(function(){n.push($(this).val())}),n}function GetThrowNum(n){return n===21?3:n%2==0?2:n%2==1?1:void 0}function ScoreGame(n){for(var i=0,t=0;t<10;t++)n.Frames[t].FrameScore=parseInt(n.Frames[t].FrameScore),n.Frames[t].FrameScore=n.Frames[t].ThrowOneScore==10?StrikeBonus(n.Frames,t):n.Frames[t].ThrowOneScore+n.Frames[t].ThrowTwoScore==10?SpareBonus(n.Frames,t):parseInt(n.Frames[t].ThrowOneScore)+parseInt(n.Frames[t].ThrowTwoScore),n.Frames[t].ThrowOneScore=parseInt(n.Frames[t].ThrowOneScore),n.Frames[t].ThrowTwoScore=parseInt(n.Frames[t].ThrowTwoScore),n.Frames[t].FrameNum==10&&n.Frames[t].ThrowOneScore+n.Frames[t].ThrowTwoScore<10&&(n.Frames[t].ThrowThreeScore=0),n.Frames[t].ThrowOneScore==10&&n.Frames[t].FrameNum!=10&&(n.Frames[t].ThrowTwoScore=0),i+=n.Frames[t].FrameScore,n.Frames[t].FrameTotal=i;return n.Score=i,n}function StrikeBonus(n,t){return t==8?(n[9].ThrowOneScore=parseInt(n[9].ThrowOneScore),n[9].ThrowTwoScore=parseInt(n[9].ThrowTwoScore),10+n[9].ThrowOneScore+n[9].ThrowTwoScore):t==9?(n[t].ThrowOneScore=parseInt(n[t].ThrowOneScore),n[t].ThrowTwoScore=parseInt(n[t].ThrowTwoScore),n[t].ThrowThreeScore=parseInt(n[t].ThrowThreeScore),n[t].ThrowOneScore+n[t].ThrowTwoScore+n[t].ThrowThreeScore):(n[t+1].ThrowOneScore=parseInt(n[t+1].ThrowOneScore),n[t+1].ThrowOneScore==10?(n[t+2].ThrowOneScore=parseInt(n[t+2].ThrowOneScore),10+n[t+1].ThrowOneScore+n[t+2].ThrowOneScore):(n[t+1].ThrowTwoScore=parseInt(n[t+1].ThrowTwoScore),10+n[t+1].ThrowOneScore+n[t+1].ThrowTwoScore))}function SpareBonus(n,t){return n[t].FrameNum==10?(n[t].ThrowThreeScore=parseInt(n[t].ThrowThreeScore),10+n[t].ThrowThreeScore):(n[t].ThrowOneScore=parseInt(n[t].ThrowOneScore),10+n[t].ThrowOneScore)}function ThrowCurrent(n){var t=n.Frames[n.CurrentFrame-1].ThrowOneScore;return n=CalculateNext(n,t),n=ScoreGame(n),n.ScoreUpToFrame<n.CurrentFrame&&(n.ScoreUpToFrame=n.CurrentFrame),n}function CalculateNext(n,t){t=parseInt(t);var i=GetThrowNum(parseInt(n.CurrentThrow));return i==1?n.CurrentFrame!=10&&t==10&&n.CurrentFrame++:i==2&&n.CurrentFrame!=10&&n.CurrentFrame++,CalculateCurrentThrow(n,t,!0)}function CalculatePrevious(n){n.CurrentFrame=parseInt(n.CurrentFrame);var t=GetThrowNum(parseInt(n.CurrentThrow));return t==1&&n.CurrentFrame!=1&&n.CurrentFrame--,CalculateCurrentThrow(n,0,!1)}function CalculateCurrentThrow(n,t,i){n.CurrentThrow=parseInt(n.CurrentThrow);n.CurrentFrame=parseInt(n.CurrentFrame);var r=GetThrowNum(parseInt(n.CurrentThrow));return n.CurrentFrame<10?n.CurrentThrow=r==1&&t!=10?n.CurrentFrame*2:n.CurrentFrame*2-1:i?n.CurrentThrow==19?n.CurrentThrow++:n.CurrentThrow==20?t+parseInt(n.Frames[n.CurrentFrame-1].ThrowTwoScore)>=10&&n.CurrentThrow++:n.CurrentThrow==21||(n.CurrentThrow=19):n.CurrentThrow!=19&&n.CurrentThrow--,n}const MISSED_10=512,MISSED_9=256,MISSED_8=128,MISSED_7=64,MISSED_6=32,MISSED_5=16,MISSED_4=8,MISSED_3=4,MISSED_2=2,MISSED_1=1,MISSED_0=0,MISSED_ALL=1023;$(document).ready(function(){for(var i,r,t=GetGameIDs(),n=0;n<t.length;n++)i=parseInt($("#"+t[n]+"_CurrentFrame").val()),r=parseInt($("#"+t[n]+"_CurrentThrow").val()),RefreshGameHid(JSON.parse(GetJSONFromPage(t[n]))),HighlightSelectedFrame(t[n],i,r)});
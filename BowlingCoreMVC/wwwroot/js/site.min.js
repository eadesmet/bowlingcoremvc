function GetJSONFromPage(n){var r={},u,t,i;for(r.Frames=[],r.ID=n,r.CurrentFrame=$("#"+n+"_CurrentFrame").val(),r.CurrentThrow=$("#"+n+"_CurrentThrow").val(),r.ScoreUpToFrame=$("#"+n+"_ScoreUpToFrame").val(),ClearHighlight(n,r.CurrentFrame),u=1;u<=10;u++)t={},i="#"+n+"_"+u+"_",t.GameID=n,t.ID=$(i+"FrameID").val(),t.FrameScore=$(i+"hidFrameScore").val(),t.FrameTotal=$(i+"hidFrameTotal").val(),t.FrameNum=$(i+"hidFrameNum").val(),t.ThrowOneScore=$(i+"1_hidFrame").val(),t.ThrowTwoScore=$(i+"2_hidFrame").val(),t.ThrowOnePins=$(i+"1_hidPins").val(),t.ThrowTwoPins=$(i+"2_hidPins").val(),u===10&&(t.ThrowThreeScore=$(i+"3_hidFrame").val(),t.ThrowThreePins=$(i+"3_hidPins").val()),r.Frames.push(t);return JSON.stringify(r)}function UpdateCurrentThrowVal(n){var o=parseInt($("#"+n+"_CurrentThrow").val()),r=parseInt($("#"+n+"_CurrentFrame").val()),t="#"+n+"_"+r+"_",i=parseInt(GetThrowNum(parseInt(o))),u=GetThrowPins(n,r,i),f,e;$(t+i+"_hidFrame").val(u.score);$(t+i+"_hidPins").val(u.missed);r===10&&i===1&&($(t+2+"_hidFrame").val(0),$(t+2+"_hidPins").val(0),$(t+3+"_hidFrame").val(0),$(t+3+"_hidPins").val(0));i===2&&(f=GetThrowHidVals(n,r,1),$(t+i+"_hidFrame").val(u.score-f.score),r===10&&f.score===10&&$(t+i+"_hidFrame").val(u.score));i===3&&(f=GetThrowHidVals(n,r,1),e=GetThrowHidVals(n,r,2),f.score+e.score>10?$(t+i+"_hidFrame").val(u.score):e.score<10&&$(t+i+"_hidFrame").val(u.score-e.score))}function GetThrowPins(n){var t=0,i=10,r=$("#"+n+"-Missed_1").is(":checked"),u=$("#"+n+"-Missed_2").is(":checked"),f=$("#"+n+"-Missed_3").is(":checked"),e=$("#"+n+"-Missed_4").is(":checked"),o=$("#"+n+"-Missed_5").is(":checked"),s=$("#"+n+"-Missed_6").is(":checked"),h=$("#"+n+"-Missed_7").is(":checked"),c=$("#"+n+"-Missed_8").is(":checked"),l=$("#"+n+"-Missed_9").is(":checked"),a=$("#"+n+"-Missed_10").is(":checked");return r&&(t=t+MISSED_1,i=i-1),u&&(t=t+MISSED_2,i=i-1),f&&(t=t+MISSED_3,i=i-1),e&&(t=t+MISSED_4,i=i-1),o&&(t=t+MISSED_5,i=i-1),s&&(t=t+MISSED_6,i=i-1),h&&(t=t+MISSED_7,i=i-1),c&&(t=t+MISSED_8,i=i-1),l&&(t=t+MISSED_9,i=i-1),a&&(t=t+MISSED_10,i=i-1),{missed:t,score:i}}function GetThrowHidVals(n,t,i){var r=parseInt($("#"+n+"_"+t+"_"+i+"_hidFrame").val()),u=parseInt($("#"+n+"_"+t+"_"+i+"_hidPins").val());return{missed:u,score:r}}function RefreshGameHid(n){var t,i;for($("#"+n.ID+"_CurrentFrame").val(n.CurrentFrame),$("#"+n.ID+"_CurrentThrow").val(n.CurrentThrow),$("#"+n.ID+"_ScoreUpToFrame").val(n.ScoreUpToFrame),t=1;t<=10;t++)$("#"+n.ID+"_"+t+"_hidFrameScore").val(n.Frames[t-1].FrameScore),$("#"+n.ID+"_"+t+"_hidFrameTotal").val(n.Frames[t-1].FrameTotal),$("#"+n.ID+"_"+t+"_1_hidFrame").val(n.Frames[t-1].ThrowOneScore),$("#"+n.ID+"_"+t+"_2_hidFrame").val(n.Frames[t-1].ThrowTwoScore),$("#"+n.ID+"_"+t+"_1_hidPins").val(n.Frames[t-1].ThrowOnePins),$("#"+n.ID+"_"+t+"_2_hidPins").val(n.Frames[t-1].ThrowTwoPins),t===10&&($("#"+n.ID+"_"+t+"_3_hidFrame").val(n.Frames[t-1].ThrowThreeScore),$("#"+n.ID+"_"+t+"_3_hidPins").val(n.Frames[t-1].ThrowThreePins)),(t<parseInt(n.ScoreUpToFrame)||parseInt(n.ScoreUpToFrame)===10)&&SetLabelsFromHid(n.ID,t),FormatFrameThrowLabels(n.ID,t);i=$("#"+n.ID+"_"+n.CurrentFrame+"_"+GetThrowNum(n.CurrentThrow)+"_hidPins").val();RefreshPinsOfCurrentThrow(n.ID,i,n.CurrentFrame,n.CurrentThrow,n.ScoreUpToFrame)}function RefreshPinsOfCurrentThrow(n,t,i,r,u){const e=new Set([1,3,5,7,9,11,13,15,17,19]),o=new Set([2,4,6,8,10,12,14,16,18]),s=new Set([20,21]);var f=parseInt($("#"+n+"_"+i+"_"+GetThrowNum(r-1)+"_hidPins").val());EnableAllMissedPins(n);r=parseInt(r);u=parseInt(u);e.has(r)?SetMissedPinsChecked(n,t):o.has(r)?(SetMissedPinsEnabled(n,f),u>=i?SetMissedPinsChecked(n,t):SetMissedPinsChecked(n,f)):s.has(r)&&(f===0?SetMissedPinsChecked(n,t):(SetMissedPinsEnabled(n,f),SetMissedPinsChecked(n,t)))}function SetMissedPinsChecked(n,t){$("#"+n+"-Missed_1").prop("checked",(t&MISSED_1)===MISSED_1);$("#"+n+"-Missed_2").prop("checked",(t&MISSED_2)===MISSED_2);$("#"+n+"-Missed_3").prop("checked",(t&MISSED_3)===MISSED_3);$("#"+n+"-Missed_4").prop("checked",(t&MISSED_4)===MISSED_4);$("#"+n+"-Missed_5").prop("checked",(t&MISSED_5)===MISSED_5);$("#"+n+"-Missed_6").prop("checked",(t&MISSED_6)===MISSED_6);$("#"+n+"-Missed_7").prop("checked",(t&MISSED_7)===MISSED_7);$("#"+n+"-Missed_8").prop("checked",(t&MISSED_8)===MISSED_8);$("#"+n+"-Missed_9").prop("checked",(t&MISSED_9)===MISSED_9);$("#"+n+"-Missed_10").prop("checked",(t&MISSED_10)===MISSED_10)}function SetMissedPinsEnabled(n,t){$("#"+n+"-Missed_1").prop("disabled",(t&MISSED_1)!==MISSED_1);$("#"+n+"-Missed_2").prop("disabled",(t&MISSED_2)!==MISSED_2);$("#"+n+"-Missed_3").prop("disabled",(t&MISSED_3)!==MISSED_3);$("#"+n+"-Missed_4").prop("disabled",(t&MISSED_4)!==MISSED_4);$("#"+n+"-Missed_5").prop("disabled",(t&MISSED_5)!==MISSED_5);$("#"+n+"-Missed_6").prop("disabled",(t&MISSED_6)!==MISSED_6);$("#"+n+"-Missed_7").prop("disabled",(t&MISSED_7)!==MISSED_7);$("#"+n+"-Missed_8").prop("disabled",(t&MISSED_8)!==MISSED_8);$("#"+n+"-Missed_9").prop("disabled",(t&MISSED_9)!==MISSED_9);$("#"+n+"-Missed_10").prop("disabled",(t&MISSED_10)!==MISSED_10)}function EnableAllMissedPins(n){$("#"+n+"-Missed_1").prop("disabled",!1);$("#"+n+"-Missed_2").prop("disabled",!1);$("#"+n+"-Missed_3").prop("disabled",!1);$("#"+n+"-Missed_4").prop("disabled",!1);$("#"+n+"-Missed_5").prop("disabled",!1);$("#"+n+"-Missed_6").prop("disabled",!1);$("#"+n+"-Missed_7").prop("disabled",!1);$("#"+n+"-Missed_8").prop("disabled",!1);$("#"+n+"-Missed_9").prop("disabled",!1);$("#"+n+"-Missed_10").prop("disabled",!1)}function SetLabelsFromHid(n,t){EmptyFrameLabels(n,t);$("#"+n+"_"+t+"_lblFrameTotal").append($("#"+n+"_"+t+"_hidFrameTotal").val())}function EmptyFrameLabels(n,t){$("#"+n+"_"+t+"_lblFrameTotal").empty();$("#"+n+"_"+t+"_1_lblFrame").empty();$("#"+n+"_"+t+"_2_lblFrame").empty();t===10&&$("#"+n+"_"+t+"_3_lblFrame").empty()}function FormatFrameThrowLabels(n,t){var i=parseInt($("#"+n+"_"+t+"_1_hidFrame").val()),r=parseInt($("#"+n+"_"+t+"_2_hidFrame").val()),f=parseInt($("#"+n+"_ScoreUpToFrame").val()),u;t!==10?i===10?$("#"+n+"_"+t+"_2_lblFrame").empty().append("X"):i+r===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append("/")):($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)):(u=parseInt($("#"+n+"_"+t+"_3_hidFrame").val()),i===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append("X"),r===10?$("#"+n+"_"+t+"_2_lblFrame").empty().append("X"):$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)):i+r===10?($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append("/")):($("#"+n+"_"+t+"_1_lblFrame").empty().append(i),$("#"+n+"_"+t+"_2_lblFrame").empty().append(r)),u===10?$("#"+n+"_"+t+"_3_lblFrame").empty().append("X"):r+u===10?$("#"+n+"_"+t+"_3_lblFrame").empty().append("/"):$("#"+n+"_"+t+"_3_lblFrame").empty().append(u),u===0&&(f<=t?$("#"+n+"_"+t+"_3_lblFrame").empty():$("#"+n+"_"+t+"_3_lblFrame").empty().append("-")));i===0&&(f<=t?$("#"+n+"_"+t+"_1_lblFrame").empty():$("#"+n+"_"+t+"_1_lblFrame").empty().append("-"));r===0&&i!==10&&(f<=t?$("#"+n+"_"+t+"_2_lblFrame").empty():$("#"+n+"_"+t+"_2_lblFrame").empty().append("-"))}function ClearHighlight(n,t){var i="#"+n+"_"+t+"_";$(i+"1_tdFrame").css("background-color","White");$(i+"2_tdFrame").css("background-color","White");$(i+"tdFrameScore").css("background-color","White");t===10&&$(i+"3_tdFrame").css("background-color","White")}function HighlightSelectedFrame(n,t,i){var u="#"+n+"_"+t+"_",r;$(u+"1_tdFrame").css("background-color","Aquamarine");$(u+"2_tdFrame").css("background-color","Aquamarine");$(u+"tdFrameScore").css("background-color","Aquamarine");t===10?($(u+"3_tdFrame").css("background-color","Aquamarine"),i===21?$(u+"3_tdFrame").css("background-color","Plum"):(r=i%2,r===0&&(r=2),r===1?$(u+"1_tdFrame").css("background-color","Plum"):r===2&&$(u+"2_tdFrame").css("background-color","Plum"))):(r=i%2,r===0&&(r=2),r===1?$(u+"1_tdFrame").css("background-color","Plum"):r===2&&$(u+"2_tdFrame").css("background-color","Plum"))}function NextClickSendGame(n){UpdateCurrentThrowVal(n);var t=GetJSONFromPage(n),i=GetGameIDs(),r={JSONGame:t,GameIDs:i};$.ajax({type:"POST",traditional:!0,async:!1,cache:!1,url:"/Game/NextThrowClick",context:document.body,data:r,success:function(n){var t=JSON.parse(n.jsonGameReturned);RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow)},error:function(n){console.log(n.responseText);alert(n.responseText)}})}function PreviousClickSendGame(n){var t=GetJSONFromPage(n),i=GetGameIDs(),r={JSONGame:t,GameIDs:i};$.ajax({type:"POST",traditional:!0,async:!1,cache:!1,url:"/Game/PreviousThrowClick",context:document.body,data:r,success:function(n){var t=JSON.parse(n.jsonGameReturned);RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow)},error:function(n){console.log(n.responseText);alert(n.responseText)}})}function SaveGameClick(n){var t=GetJSONFromPage(n),i={JSONGame:t,GameID:n};$.ajax({type:"POST",traditional:!0,async:!1,cache:!1,url:"/Game/SaveGameClick",context:document.body,data:i,success:function(n){var t=JSON.parse(n.jsonGameReturned);if(n.redirect){window.location="/Game/Edit/"+t.ID;return}RefreshGameHid(t);HighlightSelectedFrame(t.ID,t.CurrentFrame,t.CurrentThrow);$("#SavedAlert").fadeTo(4e3,500).slideDown(500,function(){$("#SavedAlert").slideUp(500)})},error:function(n){console.log(n.responseText);alert(n.responseText)}})}function GetGameIDs(){var n=[];return $(".hidGameID").each(function(){n.push($(this).val())}),n}function GetThrowNum(n){return n===21?3:n%2==0?2:n%2==1?1:void 0}const MISSED_10=512,MISSED_9=256,MISSED_8=128,MISSED_7=64,MISSED_6=32,MISSED_5=16,MISSED_4=8,MISSED_3=4,MISSED_2=2,MISSED_1=1,MISSED_0=0,MISSED_ALL=1023;$(document).ready(function(){for(var i,r,t=GetGameIDs(),n=0;n<t.length;n++)i=parseInt($("#"+t[n]+"_CurrentFrame").val()),r=parseInt($("#"+t[n]+"_CurrentThrow").val()),RefreshGameHid(JSON.parse(GetJSONFromPage(t[n]))),HighlightSelectedFrame(t[n],i,r)});